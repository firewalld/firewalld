FWD_START_TEST([service RH-Satellite-6])
AT_KEYWORDS(service rhbz1839781)

FWD_CHECK([--zone trusted --add-interface dummy0], 0, [ignore])
FWD_CHECK([--zone trusted --add-service RH-Satellite-6], 0, [ignore])

NFT_LIST_RULES([inet], [filter_IN_trusted_allow], 0, [dnl
    table inet firewalld {
        chain filter_IN_trusted_allow {
            tcp dport 80 accept
            tcp dport 443 accept
            tcp dport 9090 accept
        }
    }
])

IPTABLES_LIST_RULES([filter], [IN_trusted_allow], 0, [dnl
    ACCEPT 6 -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:80
    ACCEPT 6 -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:443
    ACCEPT 6 -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:9090
])
IP6TABLES_LIST_RULES([filter], [IN_trusted_allow], 0, [dnl
    ACCEPT 6 -- ::/0 ::/0 tcp dpt:80
    ACCEPT 6 -- ::/0 ::/0 tcp dpt:443
    ACCEPT 6 -- ::/0 ::/0 tcp dpt:9090
])

FWD_CHECK([--zone trusted --remove-service RH-Satellite-6], 0, [ignore])
FWD_CHECK([--zone trusted --add-service RH-Satellite-6-capsule], 0, [ignore])

NFT_LIST_RULES([inet], [filter_IN_trusted_allow], 0, [dnl
    table inet firewalld {
        chain filter_IN_trusted_allow {
            tcp dport 80 accept
            tcp dport 443 accept
            tcp dport 8000 accept
            tcp dport 8443 accept
            tcp dport 9090 accept
        }
    }
])

IPTABLES_LIST_RULES([filter], [IN_trusted_allow], 0, [dnl
    ACCEPT 6 -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:80
    ACCEPT 6 -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:443
    ACCEPT 6 -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:8000
    ACCEPT 6 -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:8443
    ACCEPT 6 -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:9090
])
IP6TABLES_LIST_RULES([filter], [IN_trusted_allow], 0, [dnl
    ACCEPT 6 -- ::/0 ::/0 tcp dpt:80
    ACCEPT 6 -- ::/0 ::/0 tcp dpt:443
    ACCEPT 6 -- ::/0 ::/0 tcp dpt:8000
    ACCEPT 6 -- ::/0 ::/0 tcp dpt:8443
    ACCEPT 6 -- ::/0 ::/0 tcp dpt:9090
])

FWD_END_TEST
